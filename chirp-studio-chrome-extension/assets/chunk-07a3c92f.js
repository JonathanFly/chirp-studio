/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.3.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const Ht="4.3.0",dt=Math.PI,De=2*dt,nt=dt/2,gt=8.17579892,mt="dual-combined",Ue="dual-horizontal",ve="single",ye="dual-vertical",bt="bar-index",vt="bar-level",$e="gradient",yt=60,Lt="click",Gt="fullscreenchange",qt="resize",Pt="#111",wt="",Et="A",xt="B",St="C",Rt="D",At="468",Ye="sans-serif",Xt="#0f0",Wt="#7f7f7f22",ke=10,Vt="create",Bt="fschange",Ut="lores",$t=qt,ot="user",Yt="#000c",Ct="#fff",jt="#4f4",Tt="#888",Qt="#555",rt="bark",He="linear",Me="log",lt="mel",It=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Ft=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:It}],["rainbow",{dir:"h",colorStops:["#817",...It,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],Kt=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],Jt=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],Zt=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],ht=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],ei=["ERR_INVALID_MODE","Invalid mode"],ti=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],ii=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],si=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],ai=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],ni=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class de extends Error{constructor(e,i){const[s,n]=e;super(n+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const Ot=(l,e)=>console.warn(`${l} is deprecated. Use ${e} instead.`),je=(l,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+l)[i]()))],oi=(l,e,i,s,n)=>e+(s-e)*(n-l)/(i-l);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(l){let e=this.length;for(;e-- >0;)if(l(this[e]))return e;return-1});class ri{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[];for(const[_,v]of Ft)this.registerGradient(_,v);this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let s;if(!(i.source&&(s=i.source.context))){if(!(s=i.audioCtx))try{s=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new de(Kt)}}if(!s.createGain)throw new de(Jt);const n=this._analyzer=[s.createAnalyser(),s.createAnalyser()],d=this._splitter=s.createChannelSplitter(2),r=this._merger=s.createChannelMerger(2);this._input=s.createGain(),this._output=s.createGain(),i.source&&this.connectInput(i.source);for(const _ of[0,1])d.connect(n[_],_);r.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();const a=document.createElement("canvas");a.style="max-width: 100%;",this._ctx=a.getContext("2d");for(const _ of["_scaleX","_scaleR"])this[_]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||a;const h=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas($t),this._fsTimeout=0)},yt))};window.ResizeObserver&&(this._observer=new ResizeObserver(h),this._observer.observe(this._container)),this._controller=new AbortController;const b=this._controller.signal;window.addEventListener(qt,h,{signal:b}),a.addEventListener(Gt,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(Bt),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},yt)},{signal:b});const g=()=>{s.state=="suspended"&&s.resume(),window.removeEventListener(Lt,g)};window.addEventListener(Lt,g),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:b}),this._setProps(i,!0),this.useCanvas&&this._container.appendChild(a),this._ready=!0,this._setCanvas(Vt)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=je(e,[ve,Ue,ye,mt]),this._input.disconnect(),this._input.connect(this._chLayout!=ve?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=ve?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=je(e,[$e,bt,vt])}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=je(e,[Me,rt,lt,He]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get height(){return this._height}set height(e){this._height=e,this._setCanvas(ot)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(Ut)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new de(ht);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new de(ht);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new de(ei,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new de(ti);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-nt),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return Ot("stereo","channelLayout"),this._chLayout!=ve}set stereo(e){Ot("stereo","channelLayout"),this.channelLayout=e?ye:ve}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=je(e,[wt,Et,xt,St,Rt,At],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(ot)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return Ht}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new de(ii);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==ve&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:n,_merger:d,_observer:r,_ownContext:a,_splitter:h}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),r&&r.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),n.disconnect(),h.disconnect(),d.disconnect(),a&&e.close(),i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const n=this._sources.indexOf(s);if(i&&s.mediaStream)for(const d of s.mediaStream.getAudioTracks())d.stop();n>=0&&(s.disconnect(this._input),this._sources.splice(n,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:n,hold:d,peak:r,value:a})=>({posX:e,freq:i,freqLo:s,freqHi:n,hold:d,peak:r,value:a}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const a={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!a[e])return null;[e,i]=a[e]}const s=this._freqToBin(e),n=i?this._freqToBin(i):s,d=this._chLayout==ve?1:2;let r=0;for(let a=0;a<d;a++)for(let h=s;h<=n;h++)r+=this._normalizedB(this._fftData[a][h]);return r/(n-s+1)/d}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new de(si);if(typeof i!="object")throw new de(ai);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new de(ni);const n=s.length,d=r=>+r!=r||r<0||r>1;s.forEach((r,a)=>{const h=a/Math.max(1,n-1);typeof r!="object"?s[a]={pos:h,color:r}:d(r.pos)&&(r.pos=h),d(r.level)&&(s[a].level=1-a/n)}),s.sort((r,a)=>r.level<a.level?1:r.level>a.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||Pt,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(ot)}setFreqRange(e,i){if(e<1||i<1)throw new de(ht);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,n;e&&(i=e.maxLeds|0,s=+e.spaceV,n=+e.spaceH),this._ledParams=i>0&&s>0&&n>=0?[i,s,n]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:n,_chLayout:d,_maxFreq:r,_minFreq:a,_mirror:h,_mode:b,_radial:g,_reflexRatio:_}=this,v=n.width>>1,k=n.height>>1,z=d==ye&&!g,N=d==Ue,u=b%10!=0,X=u&&this._frequencyScale==Me,Y=this._showLeds&&u&&!g,x=this._lumiBars&&u&&!g,te=this._alphaBars&&!x&&b!=ke,_e=this._outlineBars&&u&&!x&&!Y,Z=this._roundBars&&u&&!x&&!Y,y=d!=ye||_>0&&!x,ie=n.height-(z&&!Y?.5:0)>>z,q=ie*(x||g?1:1-_)|0,ee=n.width-v*(N||h!=0),t=z?n.height-ie*2:0,Q=v*(h==-1&&!N&&!g),Le=Math.min(n.width,n.height)*(d==ye?.375:.125)|0,W=Math.min(v,k),I=C=>e.push({...C,peak:[0,0],hold:[0],value:[0]}),B=C=>{const F=this._freqToBin(C,"floor"),L=this._binToFreq(F),S=this._binToFreq(F+1),M=Math.log2(C/L)/Math.log2(S/L);return[F,M]};let p,H,T;if(X){const C=(A,G,re)=>+A.toPrecision(re?Math.max(G,1+Math.log10(A)|0):G),F=A=>{const G=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],re=Math.log10(A)|0,ne=A/10**re;let le=1;for(;le<G.length&&ne>G[le];)le++;return ne-G[le-1]<G[le]-ne&&le--,(G[le]*10**(re+5)|0)/1e5},L=[0,24,12,8,6,4,3,2,1][b],S=i?10**(3/(L*10)):2**(1/L),M=S**.5;let V=i?7.94328235/(L%2?1:M):gt;do{let A=V;const G=C(A/M,4,!0),re=C(A*M,4,!0),[ne,le]=B(G),[Fe,me]=B(re);i?A=L<4?F(A):C(A,A.toString()[0]<5?3:2):A=C(A,4,!0),A>=a&&I({posX:0,freq:A,freqLo:G,freqHi:re,binLo:ne,binHi:Fe,ratioLo:le,ratioHi:me}),V*=S}while(V<=r);p=ee/e.length,e.forEach((A,G)=>A.posX=Q+G*p);const O=e[0],w=e[e.length-1];H=this._freqScaling(O.freqLo),T=ee/(this._freqScaling(w.freqHi)-H),O.freqLo<a&&(O.freqLo=a,[O.binLo,O.ratioLo]=B(a)),w.freqHi>r&&(w.freqHi=r,[w.binHi,w.ratioHi]=B(r))}else if(u){const C=[0,24,12,8,6,4,3,2,1][b]*10,F=L=>{switch(this._frequencyScale){case rt:return 1960/(26.81/(L+.53)-1);case lt:return 700*(2**L-1);case He:return L}};p=ee/C,H=this._freqScaling(a),T=ee/(this._freqScaling(r)-H);for(let L=0,S=0;L<C;L++,S+=p){const M=F(H+S/T),V=F(H+(S+p/2)/T),O=F(H+(S+p)/T),[w,A]=B(M),[G,re]=B(O);I({posX:Q+S,freq:V,freqLo:M,freqHi:O,binLo:w,binHi:G,ratioLo:A,ratioHi:re})}}else{p=1,H=this._freqScaling(a),T=ee/(this._freqScaling(r)-H);const C=this._freqToBin(a,"floor"),F=this._freqToBin(r);let L=-999;for(let S=C;S<=F;S++){const M=this._binToFreq(S),V=Q+Math.round(T*(this._freqScaling(M)-H));if(V>L)I({posX:V,freq:M,freqLo:M,freqHi:M,binLo:S,binHi:S,ratioLo:0,ratioHi:0}),L=V;else if(e.length){const O=e[e.length-1];O.binHi=S,O.freqHi=M,O.freq=(O.freqLo*M)**.5}}}let ae=0,j=0;if(Y){const C=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),F=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],L=this._ledParams,[S,M,V]=L||F[b];let O,w=q;if(L){const A=2*C;let G;O=S+1;do O--,G=w/O/(1+M),j=G*M;while((G<A||j<A)&&O>1)}else{const A=540/M;j=Math.min(M*C,Math.max(2,w/A+.1|0))}y&&(w+=j),L||(O=Math.min(S,w/(j*2)|0)),ae=V>=1?V:p*V,this._leds=[O,ae,j,w/O-j]}const R=Math.min(p-1,s*(s>0&&s<1?p:1));u&&(p-=Math.max(Y?ae:0,R)),e.forEach((C,F)=>{let L=C.posX,S=p;u&&(s==0&&!Y?(L|=0,S|=0,F>0&&L>e[F-1].posX+e[F-1].width&&(L--,S++)):L+=Math.max(Y?ae:0,R)/2,C.posX=L),C.barCenter=L+(p==1?0:S/2),C.width=S});const ue=[];for(const C of[0,1]){const F=d==ye?(ie+t)*C:0,L=F+ie,S=F+q-(!Y||y?0:j);ue.push({channelTop:F,channelBottom:L,analyzerBottom:S})}this._aux={analyzerHeight:q,analyzerWidth:ee,centerX:v,centerY:k,channelCoords:ue,channelHeight:ie,channelGap:t,initialX:Q,innerRadius:Le,outerRadius:W,scaleMin:H,unitWidth:T},this._flg={isAlpha:te,isBands:u,isLeds:Y,isLumi:x,isOctaves:X,isOutline:_e,isRound:Z,noLedGap:y},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:n,unitWidth:d}=this._aux,{canvas:r,_frequencyScale:a,_mirror:h,_noteLabels:b,_radial:g,_scaleX:_,_scaleR:v}=this,k=_.canvas,z=v.canvas,N=[],u=this._chLayout==Ue,X=this._chLayout==ye,Y=["C",,"D",,"E","F",,"G",,"A",,"B"],x=Math.min(r.width,r.height)/34|0,te=k.height>>1,_e=x>>1,Z=te*(b?.7:1.5),y=_e*(b?1:2),ie=2**(1/12);if(!b&&(this._ansiBands||a!=Me))N.push(16,31.5,63,125,250,500,1e3,2e3,4e3),a==He?N.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):N.push(8e3,16e3);else{let W=gt;for(let I=-1;I<11;I++)for(let B=0;B<12;B++){if(W>=this._minFreq&&W<=this._maxFreq){const p=Y[B],H=p=="C";(p&&b&&!h&&!u||H)&&N.push(b?[W,p+(H?I:"")]:W)}W*=ie}}z.width=z.height=(s<<1)+X*x;const q=z.width>>1,ee=q-x*.7,t=(W,I)=>{const B=De*(W/r.width),p=B-nt,H=ee*Math.cos(p),T=ee*Math.sin(p);v.save(),v.translate(q+H,q+T),v.rotate(B),v.fillText(I,0,0),v.restore()};k.width|=0,_.fillStyle=v.strokeStyle=Yt,_.fillRect(0,0,k.width,k.height),v.arc(q,q,q-x/2,0,De),v.lineWidth=x,v.stroke(),_.fillStyle=v.fillStyle=Ct,_.font=`${te}px ${Ye}`,v.font=`${_e}px ${Ye}`,_.textAlign=v.textAlign="center";let Q=-Z/4,Le=-y;for(const W of N){const[I,B]=Array.isArray(W)?W:[W,W<1e3?W|0:`${(W/100|0)/10}k`],p=d*(this._freqScaling(I)-n),H=k.height*.75,T=B[0]=="C",ae=te*(b&&!h&&!u?T?1.2:.6:3);if(_.fillStyle=v.fillStyle=T&&!h&&!u?jt:Ct,b){const j=a==Me,R=a==He;let ue=["C"];if((j||I>2e3||!R&&I>250||(!g||X)&&(!R&&I>125||I>1e3))&&ue.push("G"),(j||I>4e3||!R&&I>500||(!g||X)&&(!R&&I>250||I>2e3))&&ue.push("E"),(R&&I>4e3||(!g||X)&&(j||I>2e3||!R&&I>500))&&ue.push("D","F","A","B"),!ue.includes(B[0]))continue}p>=Q+Z/2&&p<=e&&(_.fillText(B,u&&h==-1?e-p:i+p,H,ae),(u||h&&(p>Z||h==1))&&_.fillText(B,u&&h!=1?e+p:(i||r.width)-p,H,ae),Q=p+Math.min(ae,_.measureText(B).width)/2),p>=Le+y&&p<e-y&&(t(u&&h==1?e-p:p,B),(u||h&&(p>y||h==1))&&t(u&&h!=-1?e+p:-p,B),Le=p)}}_draw(e){this._runId=requestAnimationFrame(o=>this._draw(o));const i=e-this._time,s=e-this._last,n=this._maxFPS?975/this._maxFPS:0;if(s<n)return;this._last=e-(n?s%n:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:d,isBands:r,isLeds:a,isLumi:h,isOctaves:b,isOutline:g,isRound:_,noLedGap:v}=this._flg,{analyzerHeight:k,centerX:z,centerY:N,channelCoords:u,channelHeight:X,channelGap:Y,initialX:x,innerRadius:te,outerRadius:_e}=this._aux,{_bars:Z,canvas:y,_canvasGradients:ie,_chLayout:q,_colorMode:ee,_ctx:t,_energy:Q,fillAlpha:Le,_fps:W,_linearAmplitude:I,_lineWidth:B,maxDecibels:p,minDecibels:H,_mirror:T,_mode:ae,overlay:j,_radial:R,showBgColor:ue,showPeaks:C,useCanvas:F,_weightingFilter:L}=this,S=this._scaleX.canvas,M=this._scaleR.canvas,V=W>>1,O=q==mt,w=q==Ue,A=q==ye,G=q==ve,re=a&&this._trueLeds&&ee==$e,ne=R?y.width:this._aux.analyzerWidth,le=x+ne,Fe=C&&this._peakLine&&ae==ke,me=R?_e-te:k,[Dt,di,Ne,Je]=this._leds||[];Q.val>0&&(this._spinAngle+=this._spinSpeed*De/(60*W));const kt=o=>{if(this._reflexRatio>0&&!h&&!R){let E,pe;this.reflexFit||A?(E=A&&o==0?X+Y:0,pe=X-k):(E=y.height-k*2,pe=k),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,y.height),t.drawImage(y,0,u[o].channelTop,y.width,k,0,E,y.width,pe),t.restore()}},Mt=()=>{this.showScaleX&&(R?(t.save(),t.translate(z,N),this._spinSpeed&&t.rotate(this._spinAngle+nt),t.drawImage(M,-M.width>>1,-M.width>>1),t.restore()):t.drawImage(S,0,y.height-S.height))},Nt=o=>{const E=o**2,pe=424.36,K=11599.29,Xe=25122.25,we=544496.41,be=148693636,Re=Ae=>20*Math.log10(Ae);switch(L){case Et:const Ae=be*E**2/((E+pe)*Math.sqrt((E+K)*(E+we))*(E+be));return 2+Re(Ae);case xt:const Be=be*E*o/((E+pe)*Math.sqrt(E+Xe)*(E+be));return .17+Re(Be);case St:const tt=be*E/((E+pe)*(E+be));return .06+Re(tt);case Rt:const We=((103791848e-2-E)**2+108076816e-2*E)/((9837328-E)**2+11723776*E),it=o/68966888496476e-18*Math.sqrt(We/((E+79919.29)*(E+1345600)));return Re(it);case At:const Ve=-4737338981378384e-39*o**6+2043828333606125e-30*o**4-1363894795463638e-22*E+1,Ce=1306612257412824e-34*o**5-2118150887518656e-26*o**3+.0005559488023498642*o,he=.0001246332637532143*o/Math.hypot(Ve,Ce);return 18.2+Re(he)}return 0},Ze=(o,E,pe)=>{t.beginPath(),t.moveTo(o,E),t.lineTo(o,pe),t.stroke()},et=o=>{if(o&&B){const E=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=E}},Se=o=>Math.max(0,(o*Dt|0)*(Je+Ne)-Ne),zt=o=>{Q.val=o,Q.peak>0&&(Q.hold--,Q.hold<0&&(Q.peak+=Q.hold/(V*V/2))),o>=Q.peak&&(Q.peak=o,Q.hold=V)};j&&t.clearRect(0,0,y.width,y.height);let ut=0;const ft=Z.length,_t=G?1:2;for(let o=0;o<_t;o++){const{channelTop:E,channelBottom:pe,analyzerBottom:K}=u[o],Xe=this._gradients[this._selectedGrads[o]],we=Xe.colorStops,be=we.length,Re=!ue||a&&!j?"#000":Xe.bgColor,Ae=A&&R&&o?-1:1,Be=!o&&T==-1||o&&T==1,tt=!w||o&&T!=1?0:ne>>(o||!Be),We=w&&Be?-1:1,it=()=>{const c=S.height,m=c>>1,f=I?100:p,D=I?0:H,U=I?20:5,oe=k/(f-D),ge=T!=-1&&(!w||o==0||T==1),Ee=T!=1&&(!w||o!=T);t.save(),t.fillStyle=Tt,t.font=`${m}px ${Ye}`,t.textAlign="right",t.lineWidth=1;for(let xe=f;xe>D;xe-=U){const Oe=E+(f-xe)*oe,J=xe%2==0|0;if(J){const se=Oe+m*(Oe==E?.8:.35);ge&&t.fillText(xe,c*.85,se),Ee&&t.fillText(xe,(w?ne:y.width)-c*.1,se),t.strokeStyle=Tt,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=Qt,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(x+c*J*ge,~~Oe+.5),t.lineTo(le-c*J*Ee,~~Oe+.5),t.stroke()}t.restore()},Ve=(c,m)=>{const f=fe[c]+(c<fe.length-1?(fe[c+1]-fe[c])*m:0);return isNaN(f)?-1/0:f},Ce=(c,m=We)=>m*De*((c+tt)/y.width)+this._spinAngle,he=(c,m,f)=>{const D=te+m*Ae,U=Ce(c,f);return[z+D*Math.cos(U),N+D*Math.sin(U)]},st=(c,m,f,D,U)=>{t.beginPath();for(const oe of T&&!w?[1,-1]:[We]){const[ge,Ee]=_?[Ce(c,oe),Ce(c+f,oe)]:[];t.moveTo(...he(c,m,oe)),t.lineTo(...he(c,m+D,oe)),_?t.arc(z,N,te+(m+D)*Ae,ge,Ee,oe!=1):t.lineTo(...he(c+f,m+D,oe)),t.lineTo(...he(c+f,m,oe)),_&&!U&&t.arc(z,N,te+m*Ae,Ee,ge,oe==1)}et(U),t.fill()},at=(c=0,m=0)=>{let f;if(ee==$e&&!re||ae==ke)f=ie[o];else{const D=ee==bt?m%be:we.findLastIndex(U=>a?Se(c)<=Se(U.level):c<=U.level);f=we[D].color}t.fillStyle=t.strokeStyle=f};if(F){if(w&&!R){const c=ne*(o+Be),m=Be?-1:1;t.setTransform(m,0,0,1,c,0)}if((!j||ue)&&(j&&(t.globalAlpha=this.bgAlpha),t.fillStyle=Re,(o==0||!R&&!O)&&t.fillRect(x,E-Y,ne,(j&&this.reflexAlpha==1?k:X)+Y),t.globalAlpha=1),this.showScaleY&&!h&&!R&&(o==0||!O)&&it(),a?(t.setLineDash([Je,Ne]),t.lineWidth=Z[0].width):t.lineWidth=g?Math.min(B,Z[0].width/2):B,t.save(),!R){const c=new Path2D;c.rect(0,E,y.width,k),t.clip(c)}}let fe=this._fftData[o];this._analyzer[o].getFloatFrequencyData(fe),L&&(fe=fe.map((c,m)=>c+Nt(this._binToFreq(m)))),t.beginPath();let ze=[];for(let c=0;c<ft;c++){const m=Z[c],{posX:f,barCenter:D,width:U,freq:oe,binLo:ge,binHi:Ee,ratioLo:xe,ratioHi:Oe}=m;let J=Math.max(Ve(ge,xe),Ve(Ee,Oe));for(let P=ge+1;P<Ee;P++)fe[P]>J&&(J=fe[P]);if(J=this._normalizedB(J),m.value[o]=J,ut+=J,m.peak[o]>0&&(m.hold[o]--,m.hold[o]<0&&(m.peak[o]+=m.hold[o]/(V*V/2))),J>=m.peak[o]&&(m.peak[o]=J,m.hold[o]=V),!F)continue;h||d?t.globalAlpha=J:g&&(t.globalAlpha=Le),at(J,c);const se=h?me:a?Se(J):J*me|0;if(ae==ke){const P=c?0:(this._normalizedB(fe[Z[1].binLo])*me+se)/2;if(R){if(c==0&&(w&&t.moveTo(...he(0,0)),t.lineTo(...he(0,f<0?P:se))),f>=0){const ce=[f,se];t.lineTo(...he(...ce)),ze.push(ce)}}else{if(c==0)if(T==-1&&!w)t.moveTo(x,K-(f<x?P:se));else{const ce=ge?this._normalizedB(fe[ge-1])*me:se;t.moveTo(x-B,K-ce)}(w||T!=-1||f>=x)&&t.lineTo(f,K-se)}}else if(a){if(ue&&!j&&(o==0||!O)){const P=t.globalAlpha;t.strokeStyle=Wt,t.globalAlpha=1,Ze(D,E,K),t.strokeStyle=t.fillStyle,t.globalAlpha=P}if(re){const P=h?0:we.findLastIndex(Te=>Se(J)<=Se(Te.level));let ce=K;for(let Te=be-1;Te>=P;Te--){t.strokeStyle=we[Te].color;let pt=K-(Te==P?se:Se(we[Te].level));Ze(D,ce,pt),ce=pt-Ne}}else Ze(D,K,K-se)}else if(f>=x)if(R)st(f,0,U,se,g);else if(_){const P=U/2,ce=K+P;t.beginPath(),t.moveTo(f,ce),t.lineTo(f,ce-se),t.arc(D,ce-se,P,dt,De),t.lineTo(f+U,ce),et(g),t.fill()}else{const P=g?t.lineWidth:0;t.beginPath(),t.rect(f,K+P,U,-se-P),et(g),t.fill()}const qe=m.peak[o];if(qe>0&&C&&!Fe&&!h&&f>=x&&f<le)if(g&&B>0?t.globalAlpha=1:d&&(t.globalAlpha=qe),(ee==vt||re)&&at(qe),a){const P=Se(qe);P>=Ne&&t.fillRect(f,K-P,U,Je)}else R?ae!=ke&&st(f,qe*me,U,-2):t.fillRect(f,K-qe*me,U,2)}if(F){if(t.globalAlpha=1,ae==ke){if(at(),R&&!w){if(T){let c;for(;c=ze.pop();)t.lineTo(...he(...c,-1))}t.closePath()}if(B>0&&t.stroke(),Le>0){if(R){const c=w?Ce(ne>>1):0,m=w?Ce(ne):De;t.moveTo(...he(w?ne>>1:0,0)),t.arc(z,N,te,c,m,w?!Be:!0)}else t.lineTo(le,K),t.lineTo(x,K);t.globalAlpha=Le,t.fill(),t.globalAlpha=1}if((Fe||R&&C)&&(ze=[],t.beginPath(),Z.forEach((c,m)=>{let f=c.posX,D=c.peak[o],U=m?"lineTo":"moveTo";if(R&&f<0){const oe=Z[m+1];D=oi(f,D,oe.posX,oe.peak[o],0),f=0}D*=me,Fe?(t[U](...R?he(f,D):[f,K-D]),R&&T&&!w&&ze.push([f,D])):D>0&&st(f,D,1,-2)}),Fe)){let c;for(;c=ze.pop();)t.lineTo(...he(...c,-1));t.lineWidth=1,t.stroke()}}t.restore(),w&&!R&&t.setTransform(1,0,0,1,0,0),(!w&&!O||o)&&kt(o)}}if(zt(ut/(ft<<_t-1)),F&&(T&&!R&&!w&&(t.setTransform(-1,0,0,1,y.width-x,0),t.drawImage(y,x,0,z,y.height,0,0,z,y.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),Mt()),this.showFPS){const o=S.height;t.font=`bold ${o}px ${Ye}`,t.fillStyle=Xt,t.textAlign="right",t.fillText(Math.round(W),y.width-o,o*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=ie[0],this.onCanvasDraw(this,{timestamp:e,_canvasGradients:ie}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case Me:return Math.log2(e);case rt:return 26.81*e/(1960+e)-.53;case lt:return Math.log2(1+e/700);case He:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,n=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return n<s?n:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:n}=this,{analyzerWidth:d,centerX:r,centerY:a,initialX:h,innerRadius:b,outerRadius:g}=this._aux,{isLumi:_}=this._flg,v=this._chLayout==ye,k=1-n,z=_?e.height:e.height*(1-n*!v)|0;for(const N of[0,1]){const u=this._gradients[this._selectedGrads[N]],X=u.colorStops,Y=u.dir=="h";let x;if(s?x=i.createRadialGradient(r,a,g,r,a,b-(g-b)*v):x=i.createLinearGradient(...Y?[h,0,h+d,0]:[0,0,0,z]),X){const te=v&&!this._splitGradient&&(!Y||s);for(let _e=0;_e<1+te;_e++){const Z=X.length-1;X.forEach((y,ie)=>{let q=y.pos;if(te&&(q/=2),v&&!_&&!s&&!Y&&(q*=k,!te&&q>.5*k&&(q+=.5*n)),_e==1)if(s||_){const ee=Z-ie;y=X[ee],q=1-y.pos/2}else ie==0&&q>0&&x.addColorStop(.5,y.color),q+=.5;x.addColorStop(q,y.color),v&&ie==Z&&q<.5&&x.addColorStop(.5,y.color)})}}this._canvasGradients[N]=x}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,n=(h,b,g)=>h<=b?b:h>=g?g:h,d=h=>10**(h/20);let r=this.maxDecibels,a=this.minDecibels;return i&&(r=d(r),a=d(a),e=d(e)**s),n((e-a)/(r-a)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,n=this._scaleX.canvas,d=window.devicePixelRatio/(this._loRes+1);let r=window.screen.width*d,a=window.screen.height*d;Math.abs(window.orientation)==90&&r<a&&([r,a]=[a,r]);const h=this.isFullscreen,b=h&&this._fsEl==i,g=b?r:(this._width||this._container.clientWidth||this._defaultWidth)*d|0,_=b?a:(this._height||this._container.clientHeight||this._defaultHeight)*d|0;this._pixelRatio=d,this._fsWidth=r,this._fsHeight=a,!(i.width==g&&i.height==_)&&(i.width=g,i.height=_,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,g,_)),s.lineJoin="bevel",n.width=g,n.height=Math.max(20*d,Math.min(g,_)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==h&&(e=Bt),this._fsStatus=h,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new de(Zt,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:ve,colorMode:$e,fftSize:8192,fillAlpha:1,frequencyScale:Me,gradient:Ft[0][0],ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakLine:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:wt},n=["onCanvasDraw","onCanvasResize"],d=["gradientLeft","gradientRight","height","width","stereo"],r=Object.keys(s).filter(a=>a!="start").concat(n,d);(i||e===void 0)&&(e={...s,...e});for(const a of Object.keys(e))n.includes(a)&&typeof e[a]!="function"?this[a]=void 0:r.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}console.info("Suno Studio is running");const Pe=document.querySelector("audio");Pe.crossOrigin="anonymous";var $;function li(){const l=document.querySelector("audio"),e=`
    <fieldset id="visualizer_fields">
        <label class="label">Visualizer
            <select id="presets"></select>
        </label>
        <label class="label">&nbsp;Mode
        <select data-setting="mode">
            <option value="0">Discrete</option>
            <option value="1">1/24th / 240 bands</option>
            <option value="2">1/12th / 120 bands</option>
            <option value="3">1/8th / 80 bands</option>
            <option value="4">1/6th / 60 bands</option>
            <option value="5">1/4th / 40 bands</option>
            <option value="6">1/3rd / 30 bands</option>
            <option value="7">Half / 20 bands</option>
            <option value="8">Full / 10 bands</option>
            <option value="10">Line / Area</option>
        </select>
    </label>

    <label class="label" style="padding-left: 5px">fftSize
        <select data-setting="fftSize">
            <option value="1024">1024</option>
            <option value="2048">2048</option>
            <option value="4096">4096</option>
            <option value="8192" SELECTED>8192</option>
            <option value="16384">16384</option>
            <option value="32768">32768</option>
        </select>
    </label>
    <label class="label">smoothing
        <input type="range" min="0" max=".9" step=".1" data-setting="smoothing" oninput="this.nextElementSibling.value = this.value">
        <output style="padding-left: 5px">0.5</output>
    </label>
    <button data-prop="noteLabels">ðŸŽµ Show Music Notes</button>
    <button data-prop="noteLabels" id="show_piano_button">ðŸŽ¹ Add Piano Keyboard</button>

	<button data-prop="isFullscreen" data-func="toggleFullscreen">ðŸ–µ Full Screen</button>
</fieldset>
<style>


#piano {
	margin: 10px 10px 0 4px;
	user-select: none;

}

.c4::before {
	background: #c00;
	border-radius: 50%;
	bottom: 10px;
	content: '';
	height: 6px;
	left: 50%;
	position: absolute;
	width: 6px;
}

.key {
	cursor: pointer;
	display: inline-block;
	position: relative;
}

.black {
	background: #000;
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	height: 60px;
	left: 17px;
	position: absolute;
	top: 0;
	width: 12px;
	z-index: 2;
}

.white {
	background: #fff;
	border: 2px solid #000;
	border-radius: 4px;
	height: 100px;
	margin-right: -6px;
	width: 20px;
}

.black:hover,
.white:hover {
	background: #888;
}

#visualizer_fields label, button {
    margin-left: 10px;
 }
 
 #visualizer_fields button,  #piano_fieldset button {
 
 border-radius: 6px !important;
     font-size: 14px;
     padding: 0px 4px 0px 4px;
 
     background-color: rgb(255 143 62 / 56%);
 
 }
 
 #visualizer_fields button:hover {
 
 border-radius: 6px !important;
 
     background-color: rgb(255 143 62 / 22%);
 
 }


</style>
    `,i=`

        <label class="label" style="margin-left: 20px; margin-right: 15px">Volume

            <input id="volume" type="range" min="0" max="1.0" step=".1" data-setting="volume" oninput="this.nextElementSibling.value = this.value">
            <output style="padding-left: 5px">1.0</output>
        </label>
    `;l.insertAdjacentHTML("afterend",i),document.body.insertAdjacentHTML("beforeend",e)}li();function hi(){const l=`
    <div class="box center">
			<fieldset id="piano_fieldset">
				<label class="label">Waveform
					<select id="wave">
						<option>sawtooth</option>
						<option selected>sine</option>
						<option>square</option>
						<option>triangle</option>
					</select>
				</label>

				<label class="label">Note
					<select id="note">
						<option value="">Use custom</option>
						<option value="16.35">C0 - 16.35 Hz</option>
						<option value="32.70">C1 - 32.70 Hz</option>
						<option value="65.41">C2 - 65.41 Hz</option>
						<option value="130.81">C3 - 130.81 Hz</option>
						<option value="261.63">C4 - 261.63 Hz</option>
						<option value="440" selected>A4 - 440 Hz</option>
						<option value="523.25">C5 - 523.25 Hz</option>
						<option value="1046.5">C6 - 1046.5 Hz</option>
						<option value="2093">C7 - 2093 Hz</option>
						<option value="4186.01">C8 - 4186.01 Hz</option>
						<option value="7902.13">B8 - 7902.13 Hz</option>
					</select>
				</label>

				<label class="label">Custom frequency (Hz)
					<input id="frequency" type="text">
				</label>

				<label class="label">L - Pan - R
					<input id="pan" type="range" min="-1" max="1" step=".2">
					<div class="value"></div>
				</label>

				<label class="label">Volume
					<input id="volume" type="range" min="0" max="1" step=".1">
					<div class="value"></div>
				</label>

				<button id="btn_play">Play Note</button>
				<button id="btn_soundoff">STOP Note</button>

				<div id="piano"></div>
			</fieldset>
	</div>`;var e=document.createElement("div");e.id="pianoContainer",document.body.appendChild(e),e.innerHTML=l,console.log("audioMotion.audioCtx",$.audioCtx);var i=$.audioCtx,s=i.createOscillator(),n=i.createGain(),d=i.createStereoPanner?i.createStereoPanner():!1;n.gain.value=0,s.start(),d?(s.connect(d),d.connect(n)):s.connect(n),$.connectInput(n);function r(u){u?(N.value=u,s.frequency.setValueAtTime(u,i.currentTime),n.gain.setValueAtTime(Ge.value,i.currentTime)):n.gain.linearRampToValueAtTime(0,i.currentTime+.1)}const a=2**(1/12),h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];let b="",g=27.5,_=0,v=9;do{const u=h[v],X=u.endsWith("#");b+=`
		${X?"":'<div class="key">'}
		<div class="${X?"black":"white"}${_==4&&v==0?" c4":""}" data-freq="${g.toFixed(2)}" title="${u+_}"></div>
		${X||u=="E"||u=="B"?"</div>":""}
	`,g*=a,v++,v>11&&(v=0,_++)}while(g<4200);document.getElementById("piano").innerHTML=b;let k=!1;document.querySelectorAll(".black, .white").forEach(u=>{u.addEventListener("mousedown",()=>{k=!0,r(u.dataset.freq)}),u.addEventListener("mouseover",()=>{k&&r(u.dataset.freq)}),u.addEventListener("mouseup",()=>{k=!1,r()})});const z=document.getElementById("note"),N=document.getElementById("frequency");[z,N].forEach(u=>{u.addEventListener("input",()=>{u==N&&(z.selectedIndex=0),document.getElementById("btn_play").dispatchEvent(new Event("click"))})}),document.getElementById("wave").addEventListener("change",u=>s.type=u.target.value),document.getElementById("pan").addEventListener("change",u=>{d&&d.pan.setValueAtTime(u.target.value,i.currentTime)}),Ge.addEventListener("change",()=>{n.gain.value&&(n.gain.value=Ge.value)}),document.getElementById("btn_play").addEventListener("click",()=>r(z.value||N.value)),document.getElementById("btn_soundoff").addEventListener("click",()=>r())}const ct=document.getElementById("presets"),Qe=[{name:"Bark Scale",options:{mode:1,channelLayout:"single",frequencyScale:"bark",gradient:"rainbow",linearAmplitude:!0,linearBoost:1.8,maxFreq:2e4,minFreq:20,mirror:0,overlay:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,showPeaks:!0,showScaleX:!0,weightingFilter:"D"}},{name:"Default",options:void 0},{name:"Classic LED Bars",options:{mode:6,alphaBars:!1,ansiBands:!0,barSpace:.5,channelLayout:"single",colorMode:"gradient",frequencyScale:"log",gradient:"classic",ledBars:!0,lumiBars:!1,maxFreq:2e4,minFreq:25,mirror:0,radial:!1,reflexRatio:0,showBgColor:!0,showPeaks:!0,trueLeds:!0}},{name:"Mirror Wave",options:{mode:10,channelLayout:"single",fillAlpha:.6,gradient:"rainbow",lineWidth:1.5,maxFreq:2e4,minFreq:30,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1,showScaleX:!1}},{name:"Radial Spectrum",options:{mode:5,barSpace:.1,channelLayout:"single",gradient:"prism",ledBars:!1,maxFreq:2e4,minFreq:20,mirror:0,radial:!0,showBgColor:!0,showPeaks:!0,spinSpeed:1,overlay:!0}},{name:"Dual Channel",options:{mode:10,channelLayout:"dual-combined",fillAlpha:.25,frequencyScale:"bark",gradientLeft:"steelblue",gradientRight:"orangered",linearAmplitude:!0,linearBoost:1.8,lineWidth:1.5,maxFreq:2e4,minFreq:20,mirror:0,overlay:!1,radial:!1,reflexRatio:0,showPeaks:!1,weightingFilter:"D"}},{name:"RoundBars BarLevel",options:{mode:2,alphaBars:!1,ansiBands:!1,barSpace:.25,channelLayout:"single",colorMode:"bar-level",frequencyScale:"log",gradient:"prism",ledBars:!1,linearAmplitude:!0,linearBoost:1.6,lumiBars:!1,maxFreq:16e3,minFreq:30,mirror:0,radial:!1,reflexRatio:.5,reflexAlpha:1,roundBars:!0,showPeaks:!1,showScaleX:!1,smoothing:.7,weightingFilter:"D"}},{name:"Reflex + Mirror",options:{mode:10,channelLayout:"single",gradient:"rainbow",linearAmplitude:!1,reflexRatio:.4,showBgColor:!0,showPeaks:!0,showScaleX:!1,mirror:-1,maxFreq:8e3,minFreq:20,overlay:!0,lineWidth:2,fillAlpha:.2}},{name:"Dual LED Bars",options:{mode:2,alphaBars:!1,ansiBands:!1,barSpace:.1,channelLayout:"dual-vertical",gradientLeft:"steelblue",gradientRight:"orangered",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0,showScaleX:!1,mirror:0,maxFreq:16e3,minFreq:20,overlay:!1}},{name:"Gradient Samples",options:{mode:6,alphaBars:!1,ansiBands:!1,barSpace:.4,channelLayout:"single",frequencyScale:"log",ledBars:!1,linearAmplitude:!0,linearBoost:1,lumiBars:!1,maxDecibels:-35,minDecibels:-85,maxFreq:12e3,minFreq:60,mirror:0,overlay:!1,radial:!1,reflexRatio:0,showPeaks:!1,showScaleX:!1,weightingFilter:"D"}}];Pe.crossOrigin="anonymous";let Ie=document.getElementById("audioMotionContainer");Ie||(Ie=document.createElement("div"),Ie.id="audioMotionContainer",document.body.appendChild(Ie));$=new ri(Ie,{source:Pe,onCanvasDraw:ci});Ie.style.width="100%";Ie.style.height="500px";Qe.forEach((l,e)=>{const i=new Option(l.name,e);ct.append(i)});ct.addEventListener("change",()=>{$.setOptions(Qe[ct.value].options),Ke()});console.log(Qe);$.setOptions(Qe[0].options);const Ge=document.getElementById("volume");Ge.addEventListener("change",()=>{$.volume=Ge.value});function Ke(){document.querySelectorAll("[data-setting]").forEach(l=>l.value=$[l.dataset.setting]),document.querySelectorAll('input[type="range"]').forEach(l=>updateRangeElement(l)),document.querySelectorAll("button[data-prop]").forEach(l=>l.classList.toggle("active",$[l.dataset.prop])),document.querySelectorAll("button[data-feature]").forEach(l=>l.classList.toggle("active",features[l.dataset.feature])),document.querySelectorAll("[data-flag]").forEach(l=>l.classList.toggle("active",$[l.dataset.flag]))}function ci(){const l=$.canvas,e=$.canvasCtx,i=$.pixelRatio,s=Math.max(20*i,l.height/27|0);l.width>>1,l.height>>1;const n=document.querySelector("p.css-idoyen");var d="Suno Chirp";n!=null&&(d=n.innerHTML);const r=document.querySelector("a.css-1asv5q9 img");e.font=`${s+$.getEnergy()*25*i}px Orbitron, sans-serif`,e.fillStyle="#fff8",e.textAlign="center",e.fillText(d,l.width-s*8,s*2);const a=l.height/40,h=a>>1;e.beginPath(),e.moveTo(0,h),e.lineTo(l.width*Pe.currentTime/Pe.duration,h),e.lineCap="round",e.lineWidth=a;var b=$.getEnergy();b=b*.8+.25,e.globalAlpha=b;const g=.7+b;r.style.transform=`scale(${g})`,r.style.filter=`brightness(1 + ${b})`,e.stroke()}document.querySelectorAll("[data-prop]").forEach(l=>{l.addEventListener("click",()=>{l.dataset.func?$[l.dataset.func]():$[l.dataset.prop]=!$[l.dataset.prop],Ke()})});document.querySelectorAll("[data-setting]").forEach(l=>{l.addEventListener("change",()=>{$[l.dataset.setting]=l.value,Ke()})});document.querySelectorAll("[data-setting]").forEach(l=>{l.addEventListener("change",()=>{$[l.dataset.setting]=l.value,Ke()})});document.getElementById("show_piano_button").addEventListener("click",()=>{hi(),document.getElementById("show_piano_button").remove()});
